(function(r,t){typeof exports=="object"&&typeof module<"u"?module.exports=t():typeof define=="function"&&define.amd?define(t):(r=typeof globalThis<"u"?globalThis:r||self,r.SnapyForms=t())})(this,function(){"use strict";var d=Object.defineProperty;var f=(r,t,i)=>t in r?d(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i;var l=(r,t,i)=>f(r,typeof t!="symbol"?t+"":t,i);var r=document.createElement("style");r.textContent=`#snapyforms-container{position:fixed;z-index:9999;font-family:inherit}.snapyforms-bubble{position:fixed;bottom:1rem;right:1rem;padding:.75rem;border-radius:9999px;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d;transition:all .2s;animation:animate-in .3s ease-out}.snapyforms-bubble:hover{transform:scale(1.05)}.snapyforms-form{position:fixed;bottom:100px;right:20px;width:360px;max-height:70vh;background:#fff;border-radius:.75rem;box-shadow:0 20px 25px -5px #0000001a,0 10px 10px -5px #0000000a;display:none;flex-direction:column;overflow:hidden;transform-origin:bottom right}.snapyforms-form.open{display:flex;animation:scale-up .3s ease-out forwards}.snapyforms-header{padding:.75rem 1rem;display:flex;align-items:center;justify-content:space-between;color:#fff}.snapyforms-header h2{font-size:1rem;font-weight:600;margin:0;line-height:1.2}.snapyforms-header p{font-size:.75rem;margin:0;opacity:.9}.snapyforms-content{flex:1;overflow-y:auto;padding:1rem}.snapyforms-content{scrollbar-width:thin;scrollbar-color:rgba(0,0,0,.2) transparent}.snapyforms-content::-webkit-scrollbar{width:6px}.snapyforms-content::-webkit-scrollbar-track{background:transparent}.snapyforms-content::-webkit-scrollbar-thumb{background-color:#0003;border-radius:3px}.snapyforms-field{margin-bottom:.75rem}.snapyforms-label{display:block;font-size:.875rem;font-weight:500;color:#374151;margin-bottom:.375rem}.snapyforms-input,.snapyforms-textarea{width:100%;padding:.5rem .75rem;border:1px solid rgb(229,231,235);border-radius:.5rem;font-size:.875rem;transition:border-color .2s,box-shadow .2s}.snapyforms-textarea{min-height:80px;resize:vertical}.snapyforms-rating{display:flex;gap:.5rem}.snapyforms-rating button{padding:.25rem;font-size:1.5rem;background:none;border:none;cursor:pointer;transition:transform .2s}.snapyforms-rating button:hover{transform:scale(1.1)}.snapyforms-youtube{position:relative;width:100%;padding-top:56.25%;border-radius:.5rem;overflow:hidden;background:#f1f5f9}.snapyforms-youtube iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:none;border-radius:.5rem}.snapyforms-submit{width:100%;padding:.75rem;color:#fff;border:none;border-radius:.5rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:opacity .2s}.snapyforms-submit:hover{opacity:.9}@keyframes scale-up{0%{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}@keyframes animate-in{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.snapyforms-footer{padding:.5rem 1rem;text-align:center}.snapyforms-footer a{font-size:.75rem;color:#9ca3af;text-decoration:none;transition:color .2s}.snapyforms-footer a:hover{color:#6b7280}
/*$vite$:1*/`,document.head.appendChild(r);class t{constructor(e){l(this,"config");l(this,"container",null);l(this,"formData",null);l(this,"isOpen",!1);this.config=e,this.init()}async init(){try{const e=await fetch(`https://cwcyjjogegbttltkextf.supabase.co/functions/v1/get-published-form?formId=${this.config.formId}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`}});if(!e.ok)throw new Error("Failed to load form configuration");this.formData=await e.json(),this.createContainer(),this.renderBubble()}catch(e){console.error("SnapyForms initialization failed:",e)}}createContainer(){this.container=document.createElement("div"),this.container.id="snapyforms-container",document.body.appendChild(this.container);const e=document.createElement("link");e.rel="stylesheet",e.href="widget.css",document.head.appendChild(e)}getIconSvg(e){const o={MessageCircle:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>',MessageSquare:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>',Mail:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>',HandHelpingIcon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 0 1 10 10c0 5.52-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2z"/><path d="M12 14v4"/><path d="M12 10V6"/><path d="M16 10h-8"/></svg>'};return o[e]||o.MessageCircle}generateFormHTML(){return`
      <div class="snapyforms-header" style="background-color: ${this.formData.metadata.themeColor||"#0EA5E9"}">
        <button class="snapyforms-close" onclick="this.closest('.snapyforms-form').classList.remove('open')">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
        <div>
          <h2>${this.formData.metadata.title}</h2>
          <p>${this.formData.metadata.description}</p>
        </div>
      </div>
      <div class="snapyforms-content">
        <form>
          ${this.formData.fields.map(e=>this.generateFieldHTML(e)).join("")}
          <button type="submit" class="snapyforms-submit" style="background-color: ${this.formData.metadata.themeColor||"#0EA5E9"}">
            ${this.formData.metadata.submitButtonText||"Submit"}
          </button>
        </form>
        <div class="snapyforms-footer">
          <a href="https://getlovable.io" target="_blank" rel="noopener noreferrer">
            Made with Lovable
          </a>
        </div>
      </div>
    `}generateFieldHTML(e){const o=e.required?"required":"";let n="";switch(e.type){case"text":case"email":case"number":n=`<input type="${e.type}" class="snapyforms-input" name="${e.id}" placeholder="${e.placeholder||""}" ${o}>`;break;case"textarea":n=`<textarea class="snapyforms-textarea" name="${e.id}" placeholder="${e.placeholder||""}" ${o}></textarea>`;break;case"emojiRating":n=`
          <div class="snapyforms-rating">
            ${["ðŸ˜¢","ðŸ˜•","ðŸ˜","ðŸ™‚","ðŸ˜Š"].map((a,s)=>`
              <button type="button" onclick="this.parentElement.querySelector('input').value=${s+1};this.parentElement.querySelectorAll('button').forEach(b => b.style.transform = '');this.style.transform = 'scale(1.1)'">
                ${a}
              </button>
            `).join("")}
            <input type="hidden" name="${e.id}" value="">
          </div>
        `;break;case"youtube":n=`
          <div class="snapyforms-youtube">
            <iframe
              src="${e.youtubeUrl||"https://www.youtube.com/embed/dQw4w9WgXcQ"}?modestbranding=1&showinfo=0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
            ></iframe>
          </div>
        `;break}return`
      <div class="snapyforms-field">
        <label class="snapyforms-label">
          ${e.label}
          ${o?'<span style="color: red">*</span>':""}
        </label>
        ${n}
      </div>
    `}renderBubble(){var s,m,c;const e=document.createElement("div");e.className="snapyforms-bubble",e.style.backgroundColor=this.formData.metadata.themeColor||"#0EA5E9";const o=((s=this.formData.metadata.bubbleIcon)==null?void 0:s.replace(/\s+/g,""))||"MessageCircle";e.innerHTML=this.getIconSvg(o),e.onclick=()=>this.toggleForm(),(m=this.container)==null||m.appendChild(e);const n=document.createElement("div");n.className="snapyforms-form",n.innerHTML=this.generateFormHTML(),(c=this.container)==null||c.appendChild(n);const a=n.querySelector("form");a&&(a.onsubmit=p=>this.handleSubmit(p))}async handleSubmit(e){e.preventDefault();const o=e.target,n=new FormData(o),a={};n.forEach((s,m)=>{a[m]=s});try{if(!(await fetch("https://cwcyjjogegbttltkextf.supabase.co/functions/v1/submit-form-response",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({formId:this.config.formId,responseData:a})})).ok)throw new Error("Failed to submit form");alert("Form submitted successfully!"),this.toggleForm(),o.reset()}catch(s){console.error("Form submission failed:",s),alert("Failed to submit form. Please try again.")}}toggleForm(){var o;const e=(o=this.container)==null?void 0:o.querySelector(".snapyforms-form");e&&(this.isOpen=!this.isOpen,e.classList.toggle("open",this.isOpen))}}return window.SnapyForms=t,t});
